<%= turbo_frame_tag 'filters__stage' do %>
  <fieldset data-controller="clears--stage-select">
    <button
      class="hidden"
      formmethod="GET"
      formaction="<%= clears_stage_select_path %>"
      data-turbo-frame="filters__stage"
      data-clears--stage-select-target="stageableButton"
    >
    </button>

    <%= form.input :stage_type,
               label: t("clear_form.stage_type_field.label"),
               collection: [Event, Episode, Annihilation],
               value_method: :to_s,
               label_method: :to_s,
               prompt: t("clear_form.stage_type_field.prompt"),
               wrapper_html: {
                 class: "w-full",
                 data: {
                   controller: "choices"
                 }
               },
               input_html: {
                 data: {
                   action: "clears--stage-select#updateStages"
                 }
               } %>
    <noscript>
      <button
        formmethod="GET"
        formaction="<%= clears_stage_select_path %>"
        class="btn btn-primary inline-block mt-2"
      >
        <%= t("choose") %>
      </button>
    </noscript>
    <% if stage_type %>
      <%= form.input :stageable_id,
                 label: t("clear_form.stageable_field.label", stage_type: stage_type),
                 as: :select,
                 collection: stageables,
                 value_method: :to_global_id,
                 label_method: :label,
                 prompt:
                   t("clear_form.stageable_field.prompt", stage_type: stage_type),
                 wrapper_html: {
                   class: "w-full",
                   data: {
                     controller: "choices"
                   }
                 },
                 input_html: {
                   data: {
                     action: "clears--stage-select#updateStages"
                   }
                 } %>

      <% if stage_type.challengable? %>
        <%= form.label :challenge_mode,
                   "Challenge mode",
                   class:
                     "label-text text-base #{form.object.challenge_mode ? "text-error" : ""} simple_form__label" %>
        <%= form.check_box :challenge_mode,
                       data: {
                         action: "clears--stage-select#updateStages"
                       },
                       class: "toggle toggle-error block focus:outline-base-content/20" %>
      <% end %>
      <noscript>
        <button
          formmethod="GET"
          formaction="<%= clears_stage_select_path %>"
          class="btn btn-primary inline-block mt-2"
        >
          <%= t("choose") %>
        </button>
      </noscript>
      <% if stageable %>
        <fieldset>
          <%= form.input :stage_id,
                     as: stageable.is_a?(Annihilation) ? :hidden : :select,
                     collection: selectable_stages,
                     prompt: "Select stage",
                     required: false,
                     label_method: :code,
                     include_blank: true,
                     input_html: {
                       id: "stage_select"
                     },
                     wrapper_html: {
                       data: {
                         controller: "choices"
                       }
                     } %>
        </fieldset>
      <% end %>
    <% end %>
  </fieldset>
<% end %>
